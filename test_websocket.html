sendTestMessage()">Send Test</button>
        <button onclick="connectWebSocket()">Connect</button>
        <button onclick="disconnectWebSocket()">Disconnect</button>
    </div>
    
    <div id="messages"></div>
    
    <script>
        let ws = null;
        let connected = false;
        
        function updateStatus(isConnected, message = '') {
            const statusDiv = document.getElementById('status');
            if (isConnected) {
                statusDiv.className = 'connected';
                statusDiv.innerHTML = '‚úÖ Connected' + (message ? ` - ${message}` : '');
                connected = true;
            } else {
                statusDiv.className = 'disconnected';
                statusDiv.innerHTML = '‚ùå Disconnected' + (message ? ` - ${message}` : '');
                connected = false;
            }
        }
        
        function addMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addMessage('Already connected!', 'warning');
                return;
            }
            
            const wsUrl = `ws://localhost:8000/ws`;
            addMessage(`Connecting to ${wsUrl}...`);
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                updateStatus(true, 'WebSocket connected');
                addMessage('‚úÖ WebSocket connected successfully!', 'success');
            };
            
            ws.onmessage = (event) => {
                addMessage(`üì® Received: ${event.data}`, 'received');
                try {
                    const data = JSON.parse(event.data);
                    addMessage(`üìù Parsed: ${JSON.stringify(data, null, 2)}`, 'parsed');
                } catch (e) {
                    addMessage(`‚ö†Ô∏è Could not parse as JSON: ${e.message}`, 'warning');
                }
            };
            
            ws.onclose = (event) => {
                updateStatus(false, `Code: ${event.code}, Reason: ${event.reason}`);
                addMessage(`‚ùå WebSocket closed: Code ${event.code}, Reason: ${event.reason}`, 'error');
            };
            
            ws.onerror = (error) => {
                updateStatus(false, 'Connection error');
                addMessage(`üö® WebSocket error: ${error}`, 'error');
            };
        }
        
        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                addMessage('Disconnecting WebSocket...', 'info');
            } else {
                addMessage('No active connection to disconnect', 'warning');
            }
        }
        
        function sendTestMessage() {
            if (!connected || !ws) {
                addMessage('‚ùå Not connected! Please connect first.', 'error');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                addMessage('‚ö†Ô∏è Please enter a message', 'warning');
                return;
            }
            
            const testData = {
                type: 'test_from_browser',
                message: message,
                timestamp: new Date().toISOString(),
                source: 'websocket_test_page'
            };
            
            try {
                ws.send(JSON.stringify(testData));
                addMessage(`üì§ Sent: ${JSON.stringify(testData, null, 2)}`, 'sent');
                input.value = '';
            } catch (error) {
                addMessage(`‚ùå Failed to send: ${error.message}`, 'error');
            }
        }
        
        function sendSimulatedUserMessage() {
            if (!connected || !ws) {
                addMessage('‚ùå Not connected!', 'error');
                return;
            }
            
            const simulatedMessage = {
                type: 'new_message',
                userId: 'test_user_websocket',
                message: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å WebSocket Test',
                displayName: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö WebSocket',
                pictureUrl: null,
                timestamp: new Date().toISOString()
            };
            
            try {
                ws.send(JSON.stringify(simulatedMessage));
                addMessage(`üì§ Sent simulated user message`, 'sent');
            } catch (error) {
                addMessage(`‚ùå Failed to send: ${error.message}`, 'error');
            }
        }
        
        // Auto-connect on page load
        window.addEventListener('load', () => {
            addMessage('üöÄ Page loaded. Click Connect to test WebSocket.', 'info');
        });
        
        // Handle Enter key in input
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendTestMessage();
            }
        });
    </script>
    
    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
        <h3>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h3>
        <ol>
            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Connect" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket</li>
            <li>‡∏î‡∏π status indicator ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
            <li>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å "Send Test"</li>
            <li>‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÑ‡∏´‡∏°</li>
        </ol>
        
        <button onclick="sendSimulatedUserMessage()" style="background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; margin-top: 10px;">
            üì± Send Simulated User Message
        </button>
        
        <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏´‡∏≤‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
    </div>
</body>
</html>
